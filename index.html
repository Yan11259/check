<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, user-scalable=yes">
  <title>跑团好恶CHECK表</title>
  <style id="style-block">
    *{box-sizing:border-box}
    body{margin:0;background:#ffffff;-webkit-font-smoothing:antialiased;-webkit-tap-highlight-color:transparent}
    body.no-scroll{overflow:hidden;position:fixed;width:100%}
    .page{width:var(--page-base-w,1200px);margin:0 auto;position:relative}
    .head{height:160px;background:#111111;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
    .title{font-family:Georgia,'Times New Roman','Noto Serif SC','Songti SC','STSong','SimSun',serif;color:#fff;font-size:54px;font-weight:800;position:relative;z-index:1}
    .brand{position:absolute;left:-30px;bottom:-40px;font-family:Impact,Haettenschweiler,'Arial Black','Segoe UI Black',sans-serif;font-size:200px;font-weight:900;pointer-events:none;opacity:0.7;z-index:0;background-image:radial-gradient(circle at 0 0, rgba(0,0,0,0.22) 0 2px, transparent 2px),radial-gradient(circle at 6px 6px, rgba(0,0,0,0.22) 0 2px, transparent 2px),linear-gradient(to bottom, #9ca3af 0%, #000000 100%);background-size:12px 12px,12px 12px,100% 100%;background-repeat:repeat;background-position:0 0,0 0,0 0;-webkit-background-clip:text;background-clip:text;color:transparent;-webkit-text-fill-color:transparent}
    .author{font-family:Georgia,'Times New Roman','Noto Serif SC','Songti SC','STSong','SimSun',serif;color:#111;font-size:22px;margin:30px 40px 0 40px;text-align:right}
    .profile{font-family:Georgia,'Times New Roman','Noto Serif SC','Songti SC','STSong','SimSun',serif;color:#111;font-size:20px;margin:16px 40px 0 40px;display:flex;justify-content:space-between;align-items:center}
    .profile-left,.profile-right{white-space:nowrap}
    .profile-right{text-align:right}
    .fill{appearance:none;border:0;outline:0;background:transparent;border-bottom:1px solid #e5e7eb;color:#111;font-family:Georgia,'Times New Roman','Noto Serif SC','Songti SC','STSong','SimSun',serif;font-size:20px;padding:0 2px;margin-left:6px;min-width:140px}
    .origin{font-family:Georgia,'Times New Roman','Noto Serif SC','Songti SC','STSong','SimSun',serif;color:#111;font-size:18px;margin:8px 40px 0 40px;line-height:1.2}
    .origin a{color:#111;text-decoration:underline}
    .meta{font-family:Georgia,'Times New Roman','Noto Serif SC','Songti SC','STSong','SimSun',serif;color:#111;font-size:18px;margin:8px 40px 0 40px;line-height:1.2;display:flex;justify-content:space-between;align-items:flex-start}
    .meta-left{flex:1;min-width:0}
    .meta-right{white-space:nowrap;margin-left:12px}
    .meta a{color:#111;text-decoration:underline}
    .origin a:hover{text-decoration:underline}
    .wrap{font-family:Georgia,'Times New Roman','Noto Serif SC','Songti SC','STSong','SimSun',serif;color:#111;margin:10px 40px 0 40px}
    .legend{display:flex;align-items:center;gap:18px;margin:12px 0 24px 0}
    .legend .pair{display:flex;align-items:center;gap:8px}
    .legend .t{font-size:28px;font-weight:800;color:#111}
    .label{font-size:24px;color:#4b5563}
    .ring{display:inline-block;width:32px;height:32px;border-radius:999px;background:transparent;vertical-align:middle;border:3px solid #9ca3af;cursor:pointer;user-select:none}
    .ring.sel{outline:2px solid rgba(0,0,0,0.06)}
    .rings .ring:nth-child(1).sel{background:#22c55e;border-color:#22c55e}
    .rings .ring:nth-child(2).sel{background:#f59e0b;border-color:#f59e0b}
    .rings .ring:nth-child(3).sel{background:#ef4444;border-color:#ef4444}
    .cols{display:grid;grid-template-columns:1fr 1fr;gap:24px}
    .sub{font-size:28px;font-weight:800;color:#111;margin:8px 0 10px 0}
    .sub:empty{display:none}
    .col-head{display:flex;justify-content:flex-end;gap:14px;color:#9ca3af;font-size:14px;margin:4px 0 6px 0;line-height:1.1;text-align:center}
    .col-head span{width:32px;display:inline-block}
    .list{display:flex;flex-direction:column;gap:4px}
    .row{display:flex;align-items:flex-start;justify-content:space-between;gap:4px;padding:10px 4px;border-bottom:1px solid #e5e7eb}
    .label{display:flex;flex-direction:column;flex:1;min-width:0}
    .name{display:block;font-size:26px;font-weight:800;color:#111;line-height:1.6}
    .desc{display:block;font-size:16px;color:#6b7280;margin-left:0;margin-top:1px;line-height:1.3;white-space:normal;overflow:hidden;text-overflow:ellipsis}
    .rings{display:none}
    .choice{display:flex;align-items:center;gap:6px;flex-shrink:0}
    .xmark{display:inline-block;width:32px;height:32px;cursor:pointer;background-repeat:no-repeat;background-position:center;background-size:100% 100%;position:relative;z-index:1}
    .xmark{background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'><path d='M6 2 L16 12 L26 2 L30 6 L20 16 L30 26 L26 30 L16 20 L6 30 L2 26 L12 16 L2 6 Z' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linejoin='round'/></svg>")}
    .xmark.sel{background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'><path d='M6 2 L16 12 L26 2 L30 6 L20 16 L30 26 L26 30 L16 20 L6 30 L2 26 L12 16 L2 6 Z' fill='%237f1d1d' stroke='%237f1d1d' stroke-width='2' stroke-linejoin='round'/></svg>")}
    .slider-wrap{display:flex;flex-direction:column;gap:4px;align-items:flex-start}
    .slider-wrap{position:relative}
    .slider{width:140px;appearance:none;height:12px;border-radius:6px;outline:none;background:transparent;--p:50%;--c:#e5e7eb}
    .slider::-webkit-slider-runnable-track{height:12px;border-radius:6px;border:2px solid #9ca3af;background:linear-gradient(to right, var(--c) 0 var(--p), transparent var(--p) 100%)}
    .slider::-moz-range-track{height:12px;border-radius:6px;border:2px solid #9ca3af;background:linear-gradient(to right, var(--c) 0 var(--p), transparent var(--p) 100%)}
    .slider::-webkit-slider-thumb{-webkit-appearance:none;width:2px;height:12px;border-radius:0;background:#9ca3af;border:0;box-shadow:none}
    .slider::-moz-range-thumb{width:2px;height:12px;border-radius:0;background:#9ca3af;border:0;box-shadow:none}
    .slider-labels{display:flex;justify-content:space-between;width:140px;font-size:14px;color:#6b7280}
    .slider-hit{position:absolute;left:0;right:0;top:-16px;bottom:-16px;cursor:pointer;background:transparent}
    .foot{display:flex;align-items:center;gap:12px;justify-content:flex-end;margin:18px 40px 24px 40px}
    .badge{width:120px;height:34px;border-radius:17px;background:#e5e7eb;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(0,0,0,0.1)}
    .badge span{font-family:Georgia,'Times New Roman','Noto Serif SC','Songti SC','STSong','SimSun',serif;color:#6b7280;font-size:18px}
    .actions{position:fixed;right:18px;bottom:18px;z-index:1000}
    .actions.hide{display:none}
    .btn{appearance:none;border:0;outline:0;background:#111111;color:#ffffff;font-family:Georgia,'Times New Roman',serif;font-size:18px;font-weight:800;border-radius:18px;padding:12px 18px;cursor:pointer;min-width:48px;min-height:48px;transition:transform .2s ease, box-shadow .2s ease, background-color .2s ease}
    .btn:active{transform:scale(0.98)}
    .btn.btn-lg{font-size:20px;padding:16px 24px;border-radius:999px;box-shadow:0 12px 32px rgba(0,0,0,0.25)}
    .preview{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:100}
    .preview.show{display:flex}
    .preview.show .backdrop{animation:fadeIn .18s ease}
    .preview.show .panel{animation:zoomIn .2s ease}
    .preview .backdrop{position:absolute;inset:0;background:rgba(0,0,0,0.4)}
    .preview .panel{position:relative;background:#fff;border-radius:16px;box-shadow:0 12px 32px rgba(0,0,0,0.25);padding:16px;max-width:92vw;max-height:92vh;display:flex;flex-direction:column;gap:12px}
    .preview .panel .hd{font-family:Georgia,'Times New Roman','Noto Serif SC','Songti SC','STSong','SimSun',serif;color:#111;font-size:18px;font-weight:800;display:flex;align-items:center;justify-content:space-between}
    .preview .panel img{max-width:100%;max-height:80vh;border:1px solid #e5e7eb;border-radius:8px;cursor:zoom-in}
    .preview .panel .img-wrap{max-height:80vh;overflow:auto;-webkit-overflow-scrolling:touch;touch-action:none}
    .preview .panel .img-wrap img{display:block;user-select:none;-webkit-user-select:none;-webkit-user-drag:none}
    .preview .panel .img-wrap.zoom img{max-width:none;max-height:none;cursor:grab}
    
    .preview .panel.zoom{overflow:auto}
    .preview .panel.zoom img{max-width:none;max-height:none;cursor:zoom-out}
    .preview-actions{display:flex;gap:10px;justify-content:flex-end}
    .preview .panel .preview-actions .btn.btn-lg{box-shadow:none}
    .btn[aria-disabled="true"]{opacity:.5;pointer-events:none}
    @media (max-width: 640px){
      :root{--page-base-w:800px}
      .head{height:160px;padding:0}
      .title{font-size:clamp(28px,7.5vw,42px);max-width:100%;margin:0 auto;padding:0 16px;line-height:1.2;white-space:normal;text-align:center}
      .brand{font-size:140px;left:-20px;bottom:-30px;opacity:0.6}
      .author,.profile,.origin,.meta,.wrap,.notes,.foot{margin-left:16px;margin-right:16px}
      .profile-left,.profile-right{white-space:normal}
      .profile{flex-direction:column;align-items:flex-start;gap:6px}
      .profile-item{display:block}
      .meta{font-size:14px}
      .meta-left,.meta-right{font-size:8px}
      .name{font-size:20px;line-height:1.5}
      .desc{font-size:12px}
      .legend .t{font-size:18px}
      .legend .label{font-size:16px}
      .actions{right:12px;bottom:12px}
      .btn{min-width:56px;min-height:56px}
      .btn.btn-lg{font-size:22px;padding:18px 26px}
      .preview .panel{padding:12px;max-width:96vw;max-height:94vh}
      .preview .panel .hd{font-size:16px;gap:8px}
      .preview-actions{gap:8px;flex-wrap:wrap}
      .preview .panel .preview-actions .btn{min-width:auto;min-height:40px;padding:10px 12px;font-size:16px;border-radius:12px}
      .preview .panel .preview-actions .btn.btn-lg{font-size:16px;padding:10px 12px;border-radius:12px;box-shadow:none}
      html,body{overflow-x:hidden}
      .page-wrap{overflow:hidden}
      .page{transform:none;width:100vw}
      .cols{display:grid;grid-template-columns:1fr;gap:12px}
      .row{justify-content:space-between}
      .choice{gap:8px;margin-left:auto}
      .slider{width:140px}
      .slider{height:12px}
      .slider::-webkit-slider-runnable-track{height:12px}
      .slider::-moz-range-track{height:12px}
      .slider::-webkit-slider-thumb{height:12px}
      .slider::-moz-range-thumb{height:12px}
    }
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    @keyframes zoomIn{from{transform:scale(0.98);opacity:0}to{transform:scale(1);opacity:1}}
    .notes{font-family:Georgia,'Times New Roman','Noto Serif SC','Songti SC','STSong','SimSun',serif;color:#111;margin:20px 40px}
    .notes-hd{font-size:20px;font-weight:800;margin-bottom:8px}
    .notes-input{width:100%;min-height:120px;border:1px solid #e5e7eb;border-radius:8px;padding:10px;font-family:Georgia,'Times New Roman','Noto Serif SC','Songti SC','STSong','SimSun',serif;font-size:18px;color:#111;resize:none}
  </style>
</head>
<body>
  <div class="page-wrap"><div class="page" id="capture">
    <div class="head"><div class="title">跑团好恶CHECK表</div><div class="brand">inSANe</div></div>
    <div class="meta"><div class="meta-left">翻译/参考『蜜蝋文庫専用・地雷チェックシート』【 <a href="https://www.pixiv.net/novel/show.php?id=14545836" target="_blank" rel="noopener noreferrer">https://www.pixiv.net/novel/show.php?id=14545836</a> 】<br>
      シナリオ要素事前チェックシート【 <a href="https://fimless.booth.pm/items/2640500" target="_blank" rel="noopener noreferrer">https://fimless.booth.pm/items/2640500</a> 】</div><div class="meta-right">翻译：瞬蓝  制表：燕</div></div>
    <div class="profile"><span class="profile-left"><span class="profile-item">填表人：<input class="fill" type="text"></span><span class="profile-item">常用跑团平台：<input class="fill" type="text"></span></span></div>
    
    <div class="wrap">
      <div class="legend">
        <span class="t">选项说明：</span>
        <span class="pair"><span class="label">不希望出现在我身上</span><span class="xmark sel" title="旁观OK，我参与NO"></span></span>
      </div>
      <div class="cols">
        <div>
          <div class="col-head"><span></span></div>
          <div class="list">
            <div class="row"><span class="name">PC死亡</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">PC杀人</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">PC犯罪</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">PC社会性死亡</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">PC间对立</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">NPC死亡</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">撕卡率高</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">确定撕卡</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">复杂机制</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">困难的战斗</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">询问</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">恋爱要素</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">BL</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">GL</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">NL</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">相同面容CP（水仙）</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">女体化</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">兄弟情（Bromance）</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">变性人</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">作为创作物的性别偏见</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">肉体上NTR、被NTR</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">精神上NTR、被NTR</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">近亲相奸</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">未合意性行为</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">堕胎</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">精神疾病</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">肉体疾病</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">多重人格</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">记忆丧失</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">自残行为</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">自杀</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">殉情</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">暴力表现</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">猎奇描写</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">四肢欠损</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">虫</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">战争</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">宗教</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">药物（Drug）</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">火</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">火灾</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">地震</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">海啸</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
          </div>
        </div>
        <div>
          <div class="sub"></div>
          <div class="col-head"><span></span></div>
          <div class="list">
            <div class="row"><span class="name">人偶</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">食人</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">密集恐惧症</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">轮回</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">转生</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">现实的神佛</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">以实际存在事件为原型描写</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">死后世界的独自设定</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">死者复活</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">重要之人的仿冒品</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">登场人物拟态成他人</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">PC之中栖息其他存在</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">PC变为非人</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">毫不讲理的展开</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">毫不讲理的死</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">与PC意志无关描写PC的行动</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">尽最大努力还是BAD END</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">不存在HAPPY END</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">赋予PC特殊设定（自认内容）</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">赋予PC特殊设定（未自认内容）</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">R-15</span><span class="desc">虽然没有具体的性描写、但描述暗示了其内容。</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">R-18</span><span class="desc">有具体的性描写。</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">R-18G</span><span class="desc">包含过度的猎奇描写。</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">科幻设定</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">魔幻设定</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">恋爱要素</span><span class="desc">特指PC或NPC的文档/秘密内指定恋爱倾向。</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">多角恋爱</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">异种恋爱</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">排泄</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">蛇</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">政治敏感描述</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">现实古代</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">架空古代</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">（校园/职场）霸凌</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">对规则原本世界观的修改·个人解释</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">使用来自其他作品的世界观</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">使用来自其他作品的角色</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">克苏鲁神话元素</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">使用同人扩展/原创战斗数据</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">无剧情分歧（一本道）</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">不严谨/以搞笑内容为主（茶番）</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">平行世界</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
            <div class="row"><span class="name">拷问/虐待</span><div class="rings"><span class="ring"></span><span class="ring"></span><span class="ring"></span></div></div>
          </div>
        </div>
      </div>
    </div>
    <div class="notes">
      <div class="notes-hd">关于雷点，我还想说：</div>
      <textarea class="notes-input"></textarea>
    </div>
    <div class="foot"></div>
  </div></div>
  <div class="actions"><button class="btn btn-lg" id="btnExport">导出图片</button></div>
  <div id="preview" class="preview">
    <div class="backdrop"></div>
    <div class="panel">
      <div class="hd">
        <span>导出预览</span>
        <div class="preview-actions">
          <a class="btn btn-lg" id="btnDownloadPng" download="选择结果.png">下载PNG</a>
          <button class="btn" id="btnClosePreview">关闭</button>
        </div>
      </div>
      <div class="img-wrap"><img id="preview-img" alt="预览图" draggable="false"></div>
    </div>
  </div>
  <script>
    document.querySelectorAll('.rings').forEach(function(group){
      group.addEventListener('click',function(e){
        if(e.target.classList.contains('ring')){
          Array.prototype.forEach.call(group.children,function(r){r.classList.remove('sel')});
          e.target.classList.add('sel');
        }
      });
    });
    var __previewTempUrl=null;
    var __previewPngUrl=null;
    function showPreview(pngUrl, svgUrl){
      var panel=document.getElementById('preview');
      var img=document.getElementById('preview-img');
      var btnPng=document.getElementById('btnDownloadPng');
      __previewPngUrl=pngUrl || null;
      img.src=pngUrl || svgUrl;
      if(pngUrl){
        btnPng.href=pngUrl;
        btnPng.removeAttribute('aria-disabled');
      }else{
        btnPng.setAttribute('aria-disabled','true');
      }
      var nameInput=document.querySelector('.profile-left input.fill');
      var nm=(nameInput && nameInput.value)?nameInput.value.trim():'';
      var safeNm=nm.replace(/[\\\/:*?"<>|]/g,'');
      var filename=(safeNm? (safeNm+'的跑团好恶CHECK表.png') : '跑团好恶CHECK表.png');
      btnPng.setAttribute('download', filename);
      panel.classList.add('show');
      var inner=panel.querySelector('.panel');
      if(inner){ inner.classList.remove('zoom'); }
      document.body.classList.add('no-scroll');
      var actions=document.querySelector('.actions');
      if(actions){ actions.classList.add('hide'); }
    }
    function closePreview(){
      var panel=document.getElementById('preview');
      panel.classList.remove('show');
      document.body.classList.remove('no-scroll');
      var actions=document.querySelector('.actions');
      if(actions){ actions.classList.remove('hide'); }
      var wrap=document.querySelector('#preview .img-wrap');
      var img=document.getElementById('preview-img');
      if(wrap){ wrap.classList.remove('zoom'); }
      if(img){ img.style.transform=''; img.style.cursor='zoom-in'; }
      if(__previewTempUrl){URL.revokeObjectURL(__previewTempUrl);__previewTempUrl=null}
    }
    document.getElementById('btnClosePreview').addEventListener('click',closePreview);
    document.querySelector('#preview .backdrop').addEventListener('click',closePreview);
    function applyPageScale(){
      var vw = Math.max(document.documentElement.clientWidth||0, window.innerWidth||0);
      var page=document.querySelector('.page');
      var baseW=1200;
      if(page){
        var bw=parseInt(getComputedStyle(page).width,10);
        if(bw>0){ baseW=bw; }
      }
      var s = Math.min(1, (vw/baseW));
      document.documentElement.style.setProperty('--page-scale', s.toFixed(3));
      var wrap=document.querySelector('.page-wrap');
      if(page&&wrap){
        if(s<1){
          var h = Math.ceil(page.offsetHeight * s);
          wrap.style.height = h+'px';
        }else{
          wrap.style.height='auto';
        }
      }
    }
    window.addEventListener('load', applyPageScale);
    window.addEventListener('resize', applyPageScale);
    var __zoomActive=false;
    var __zoomScale=1;
    var __zoomDx=0;
    var __zoomDy=0;
    var __dragging=false;var __lastX=0;var __lastY=0;
    function applyZoomTransform(){
      var img=document.getElementById('preview-img');
      img.style.transform='translate('+__zoomDx+'px,'+__zoomDy+'px) scale('+__zoomScale+')';
      img.style.cursor=__zoomActive? (__dragging?'grabbing':'grab') : 'zoom-in';
    }
    function toggleZoom(){
      var wrap=document.querySelector('#preview .img-wrap');
      if(!wrap) return;
      if(!__zoomActive){
        __zoomActive=true;wrap.classList.add('zoom');
        __zoomScale=(window.innerWidth<=640?1.3:1.5);__zoomDx=0;__zoomDy=0;applyZoomTransform();
      }else{
        __zoomActive=false;wrap.classList.remove('zoom');
        __zoomScale=1;__zoomDx=0;__zoomDy=0;var img=document.getElementById('preview-img');img.style.transform='';img.style.cursor='zoom-in';
      }
    }
    document.getElementById('preview-img').addEventListener('click',function(e){toggleZoom();});
    function onPointerDown(e){
      if(!__zoomActive) return;
      __dragging=true;__lastX=e.clientX;__lastY=e.clientY;applyZoomTransform();
      if(e.currentTarget && e.currentTarget.setPointerCapture){e.currentTarget.setPointerCapture(e.pointerId)}
      e.preventDefault();
    }
    function onPointerMove(e){
      if(!__zoomActive||!__dragging) return;
      var dx=e.clientX-__lastX;var dy=e.clientY-__lastY;__lastX=e.clientX;__lastY=e.clientY;
      __zoomDx+=dx;__zoomDy+=dy;applyZoomTransform();
      e.preventDefault();
    }
    function onPointerUp(e){
      if(!__zoomActive) return;__dragging=false;applyZoomTransform();e.preventDefault();
    }
    function onWheel(e){
      if(!__zoomActive) return;
      var delta=e.deltaY<0?1.1:0.9;var next=Math.max(1, Math.min(2, __zoomScale*delta));
      __zoomScale=next;applyZoomTransform();e.preventDefault();
    }
    document.querySelector('#preview .img-wrap').addEventListener('pointerdown',onPointerDown);
    document.querySelector('#preview .img-wrap').addEventListener('pointermove',onPointerMove);
    document.querySelector('#preview .img-wrap').addEventListener('pointerup',onPointerUp);
    document.querySelector('#preview .img-wrap').addEventListener('pointercancel',onPointerUp);
    document.querySelector('#preview .img-wrap').addEventListener('wheel',onWheel,{passive:false});
    if(!window.PointerEvent){
      var wrap=document.querySelector('#preview .img-wrap');
      function ts(e){ if(!__zoomActive) return; __dragging=true; var t=e.touches&&e.touches[0]; if(!t) return; __lastX=t.clientX; __lastY=t.clientY; applyZoomTransform(); e.preventDefault(); }
      function tm(e){ if(!__zoomActive||!__dragging) return; var t=e.touches&&e.touches[0]; if(!t) return; var dx=t.clientX-__lastX; var dy=t.clientY-__lastY; __lastX=t.clientX; __lastY=t.clientY; __zoomDx+=dx; __zoomDy+=dy; applyZoomTransform(); e.preventDefault(); }
      function te(e){ if(!__zoomActive) return; __dragging=false; applyZoomTransform(); e.preventDefault(); }
      wrap.addEventListener('touchstart',ts,{passive:false});
      wrap.addEventListener('touchmove',tm,{passive:false});
      wrap.addEventListener('touchend',te,{passive:false});
      wrap.addEventListener('touchcancel',te,{passive:false});
    }
    // 动态为每一行添加叉叉控件并包裹选项圈 & 均衡两列高度
    (function(){
      document.querySelectorAll('.row').forEach(function(row){
        var rings=row.querySelector('.rings');
        if(!rings) return;
        if(rings.previousElementSibling && rings.previousElementSibling.classList && rings.previousElementSibling.classList.contains('xmark')) return;
        var choice=document.createElement('div');
        choice.className='choice';
        var x=document.createElement('span');
        x.className='xmark';
        var sliderWrap=document.createElement('div');
        sliderWrap.className='slider-wrap';
        var slider=document.createElement('input');
        slider.className='slider';
        slider.type='range';
        slider.min='0';
        slider.max='100';
        slider.step='1';
        slider.value='50';
        function updateFill(){
          var v=parseInt(slider.value,10)||0;
          var t=v/100;
          var g=[22,163,74];
          var m=[229,231,235];
          var r=[220,38,38];
          var mix=function(a,b,u){return [
            Math.round(a[0]*(1-u)+b[0]*u),
            Math.round(a[1]*(1-u)+b[1]*u),
            Math.round(a[2]*(1-u)+b[2]*u)
          ]};
          var col = t<=0.5 ? mix(g,m,t*2) : mix(m,r,(t-0.5)*2);
          var hex = '#'+col.map(function(x){var s=x.toString(16);return s.length===1?'0'+s:s}).join('');
          slider.style.setProperty('--p', v+'%');
          slider.style.setProperty('--c', hex);
          var lbls=(labels && labels.querySelectorAll)?labels.querySelectorAll('span'):null;
          if(lbls && lbls.length===3){
            lbls[0].style.color = (v===0)? '#16a34a' : '#6b7280';
            lbls[0].style.fontWeight = (v===0)? '800' : '400';
            lbls[1].style.color = '#6b7280';
            lbls[1].style.fontWeight = '400';
            lbls[2].style.color = (v===100)? '#dc2626' : '#6b7280';
            lbls[2].style.fontWeight = (v===100)? '800' : '400';
          }
        }
        slider.addEventListener('input', updateFill);
        updateFill();
        var labels=document.createElement('div');
        labels.className='slider-labels';
        labels.innerHTML='<span>喜欢</span><span>无所谓</span><span>讨厌</span>';
        sliderWrap.appendChild(slider);
        sliderWrap.appendChild(labels);
        var hit=document.createElement('div');
        hit.className='slider-hit';
        sliderWrap.appendChild(hit);
        function setFromClientX(cx){
          var rect=slider.getBoundingClientRect();
          var w=Math.max(1,rect.width);
          var pos=Math.min(Math.max(0,cx-rect.left),w);
          var v=Math.round(pos/w*100);
          slider.value=String(v);
          updateFill();
        }
        function hDown(e){
          var cx=e.clientX;
          if(cx==null && e.touches && e.touches[0]) cx=e.touches[0].clientX;
          if(cx==null) return;
          setFromClientX(cx);
          if(hit.setPointerCapture && e.pointerId!=null){hit.setPointerCapture(e.pointerId)}
          e.preventDefault();
        }
        function hMove(e){
          var cx=e.clientX;
          if(cx==null && e.touches && e.touches[0]) cx=e.touches[0].clientX;
          if(cx==null) return;
          setFromClientX(cx);
          e.preventDefault();
        }
        hit.addEventListener('pointerdown',hDown);
        hit.addEventListener('pointermove',hMove);
        hit.addEventListener('touchstart',hDown,{passive:false});
        hit.addEventListener('touchmove',hMove,{passive:false});
        // 快捷点击标签触发极值
        var lblNodes=labels.querySelectorAll('span');
        if(lblNodes && lblNodes.length===3){
          lblNodes[0].addEventListener('click',function(e){slider.value='0';updateFill();});
          lblNodes[2].addEventListener('click',function(e){slider.value='100';updateFill();});
        }
        rings.parentNode.replaceChild(choice,rings);
        choice.appendChild(x);
        choice.appendChild(sliderWrap);
        var name=row.querySelector('.name');
        var desc=row.querySelector('.desc');
        if(name && desc && (!name.parentElement || !name.parentElement.classList.contains('label'))){
          var label=document.createElement('div');
          label.className='label';
          row.insertBefore(label, name);
          label.appendChild(name);
          label.appendChild(desc);
        }
        x.addEventListener('click',function(e){
          e.stopPropagation();
          x.classList.toggle('sel');
        });
      });
      
      function sortRows(){
        var cols=document.querySelectorAll('.cols > div');
        if(cols.length<2) return;
        var left=cols[0].querySelector('.list');
        var right=cols[1].querySelector('.list');
        if(!left||!right) return;
        var rows=Array.prototype.slice.call(left.children).concat(Array.prototype.slice.call(right.children));
        var coll=new Intl.Collator('zh');
        rows.sort(function(a,b){
          var ta=(a.querySelector('.name')?a.querySelector('.name').textContent:'').trim();
          var tb=(b.querySelector('.name')?b.querySelector('.name').textContent:'').trim();
          var ca=ta.charAt(0);
          var cb=tb.charAt(0);
          var ccmp=coll.compare(ca,cb);
          if(ccmp!==0) return ccmp;
          return coll.compare(ta,tb);
        });
        left.innerHTML='';
        right.innerHTML='';
        rows.forEach(function(r){left.appendChild(r)});
      }
      function balanceCols(){
        var cols=document.querySelectorAll('.cols > div');
        if(cols.length<2) return;
        var left=cols[0].querySelector('.list');
        var right=cols[1].querySelector('.list');
        if(!left||!right) return;
        var rows=Array.prototype.slice.call(left.children).concat(Array.prototype.slice.call(right.children));
        var heights=rows.map(function(r){return r.getBoundingClientRect().height});
        var total=heights.reduce(function(a,b){return a+b},0);
        var target=total/2;
        var sum=0; var split=rows.length;
        for(var i=0;i<heights.length;i++){
          var next=sum+heights[i];
          if(next>=target){
            // choose closer split point
            var diffPrev=Math.abs(target-sum);
            var diffNext=Math.abs(target-next);
            split = diffNext<diffPrev ? (i+1) : i;
            break;
          }
          sum=next;
        }
        left.innerHTML='';
        right.innerHTML='';
        rows.slice(0,split).forEach(function(r){left.appendChild(r)});
        rows.slice(split).forEach(function(r){right.appendChild(r)});
      }
      window.addEventListener('load',function(){sortRows();balanceCols();});
      window.addEventListener('resize',function(){balanceCols();});
      sortRows();
      balanceCols();
    })();
    function exportImage(){
      var target=document.getElementById('capture');
      var style=document.getElementById('style-block').textContent;
      style=style.replace(/@media\s*\(max-width:\s*640px\)\s*\{[\s\S]*?\}/,'');
      var cloned=target.cloneNode(true);
      (function syncFormAndIcons(){
        var origTextareas=document.querySelectorAll('#capture textarea');
        var clonedTextareas=cloned.querySelectorAll('textarea');
        for(var i=0;i<clonedTextareas.length;i++){
          clonedTextareas[i].textContent=(origTextareas[i]&&origTextareas[i].value)||'';
        }
        var origInputs=document.querySelectorAll('#capture input');
        var clonedInputs=cloned.querySelectorAll('input');
        for(var j=0;j<clonedInputs.length;j++){
          var ci=clonedInputs[j];
          var oi=origInputs[j];
          if(ci.type==='checkbox'||ci.type==='radio'){
            if(oi&&oi.checked){ci.setAttribute('checked','checked')}else{ci.removeAttribute('checked')}
          }else{
            ci.setAttribute('value', (oi&&oi.value)||'');
          }
        }
        var origSliders=document.querySelectorAll('#capture .slider');
        var clonedSliders=cloned.querySelectorAll('.slider');
        for(var si=0;si<clonedSliders.length;si++){
          var os=origSliders[si];
          var cs=clonedSliders[si];
          if(!cs) continue;
          var v=parseInt((os&&os.value)||cs.getAttribute('value')||'50',10)||0;
          cs.setAttribute('value', String(v));
          var t=v/100;
          var g=[22,163,74];
          var m=[229,231,235];
          var r=[220,38,38];
          var mix=function(a,b,u){return [
            Math.round(a[0]*(1-u)+b[0]*u),
            Math.round(a[1]*(1-u)+b[1]*u),
            Math.round(a[2]*(1-u)+b[2]*u)
          ]};
          var col = t<=0.5 ? mix(g,m,t*2) : mix(m,r,(t-0.5)*2);
          var hex = '#'+col.map(function(x){var s=x.toString(16);return s.length===1?'0'+s:s}).join('');
          cs.style.setProperty('--p', v+'%');
          cs.style.setProperty('--c', hex);
          var lblWrap=cs.parentElement&&cs.parentElement.querySelector('.slider-labels');
          if(lblWrap){
            var lbls=lblWrap.querySelectorAll('span');
            if(lbls&&lbls.length===3){
              lbls[0].style.color = (v===0)? '#16a34a' : '#6b7280';
              lbls[0].style.fontWeight = (v===0)? '800' : '400';
              lbls[1].style.color = '#6b7280';
              lbls[1].style.fontWeight = '400';
              lbls[2].style.color = (v===100)? '#dc2626' : '#6b7280';
              lbls[2].style.fontWeight = (v===100)? '800' : '400';
            }
          }
        }
        var unSelSvg="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'><path d='M6 2 L16 12 L26 2 L30 6 L20 16 L30 26 L26 30 L16 20 L6 30 L2 26 L12 16 L2 6 Z' fill='none' stroke='%239ca3af' stroke-width='2' stroke-linejoin='round'/></svg>";
        var selSvg="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'><path d='M6 2 L16 12 L26 2 L30 6 L20 16 L30 26 L26 30 L16 20 L6 30 L2 26 L12 16 L2 6 Z' fill='%237f1d1d' stroke='%237f1d1d' stroke-width='2' stroke-linejoin='round'/></svg>";
        Array.prototype.forEach.call(cloned.querySelectorAll('.xmark'),function(x){
          var isSel=x.classList.contains('sel');
          x.setAttribute('style','background:none');
          var img=document.createElement('img');
          img.width=32;img.height=32;img.src=isSel?selSvg:unSelSvg;
          x.innerHTML='';
          x.appendChild(img);
        });
      })();
      cloned.style.width='1200px';
      cloned.style.transform='none';
      var cols=cloned.querySelector('.cols');
      if(cols){
        cols.style.display='grid';
        cols.style.gridTemplateColumns='1fr 1fr';
        cols.style.gap='24px';
      }
      var prof=cloned.querySelector('.profile');
      if(prof){
        prof.style.flexDirection='row';
        prof.style.alignItems='center';
      }
      var tmp=document.createElement('div');
      tmp.style.cssText='position:fixed;left:-99999px;top:-99999px;width:1200px;opacity:0;pointer-events:none;';
      tmp.appendChild(cloned);
      document.body.appendChild(tmp);
      var w=1200;
      var baseRect=cloned.getBoundingClientRect();
      var baseTop=baseRect.top;
      function bottomOf(el){
        if(!el) return 0;
        var r=el.getBoundingClientRect();
        return Math.max(0, r.bottom - baseTop);
      }
      var contentBottom=0;
      var headEl=cloned.querySelector('.head');
      var metaEl=cloned.querySelector('.meta');
      var profEl=cloned.querySelector('.profile');
      var wrapEl=cloned.querySelector('.wrap');
      var footEl=cloned.querySelector('.foot');
      contentBottom=Math.max(contentBottom,bottomOf(headEl));
      contentBottom=Math.max(contentBottom,bottomOf(metaEl));
      contentBottom=Math.max(contentBottom,bottomOf(profEl));
      contentBottom=Math.max(contentBottom,bottomOf(wrapEl));
      // 取两列中最后一条内容的底部
      var lists=cloned.querySelectorAll('.cols .list');
      lists.forEach(function(list){
        if(!list) return;
        var last=list.lastElementChild;
        contentBottom=Math.max(contentBottom,bottomOf(last));
      });
      // notes 仅在有内容时计入高度，避免空白
      var ta=cloned.querySelector('.notes-input');
      if(ta && ta.value && ta.value.trim()!==''){
        var notesEl=cloned.querySelector('.notes');
        contentBottom=Math.max(contentBottom,bottomOf(notesEl));
      }
      // foot 仅在有内容时计入高度
      if(footEl && footEl.textContent && footEl.textContent.trim()!==''){
        contentBottom=Math.max(contentBottom,bottomOf(footEl));
      }
      // 回退与缓冲
      if(!contentBottom || contentBottom<baseRect.height*0.6){
        contentBottom=baseRect.height;
      }
      var padding=48;
      var scrollH = cloned.scrollHeight || 0;
      var extra=400;
      var h=Math.ceil(Math.max(1, Math.max(contentBottom, scrollH) + padding + extra));
      document.body.removeChild(tmp);
      var serializer=new XMLSerializer();
      var xhtml=serializer.serializeToString(cloned);
      var svg='\n<svg xmlns="http://www.w3.org/2000/svg" width="'+w+'" height="'+h+'">\n'+
              '<rect x="0" y="0" width="'+w+'" height="'+h+'" fill="#ffffff"/>\n'+
              '<foreignObject x="0" y="0" width="'+w+'" height="'+h+'">\n'+
                '<div xmlns="http://www.w3.org/1999/xhtml">\n'+
                  '<style>'+style+' :root{--page-scale:1} #capture{transform:none!important;width:1200px!important} #capture .cols{display:grid!important;grid-template-columns:1fr 1fr!important;gap:24px!important} #capture .profile{flex-direction:row!important;align-items:center!important} #capture .profile-item{display:inline!important} #capture .profile-left, #capture .profile-right{white-space:nowrap!important} #capture .name{font-size:26px!important;line-height:1.6!important} #capture .desc{font-size:16px!important} #capture .legend .t{font-size:28px!important} #capture .legend .label{font-size:24px!important} #capture .meta, #capture .meta-left, #capture .meta-right{font-size:18px!important} .xmark{background:none!important} .xmark img{display:block;width:32px;height:32px}</style>'+xhtml+
                '</div>\n'+
              '</foreignObject>\n'+
            '</svg>';
      var dataUrl='data:image/svg+xml;charset=utf-8,'+encodeURIComponent(svg);
      var img=new Image();
      img.crossOrigin='anonymous';
      img.onload=function(){
        var canvas=document.createElement('canvas');
        var scale=Math.max(2,window.devicePixelRatio||1);
        canvas.width=w*scale;canvas.height=h*scale;
        var ctx=canvas.getContext('2d', { willReadFrequently: true });
        ctx.setTransform(scale,0,0,scale,0,0);
        ctx.imageSmoothingEnabled=true;
        ctx.drawImage(img,0,0);
        var finalCanvas=canvas;
        try{
          var thresh=250;
          var stride=8;
          var foundY=-1;
          for(var yy=canvas.height-1;yy>=0;yy--){
            var line=ctx.getImageData(0,yy,canvas.width,1).data;
            for(var xx=0;xx<canvas.width;xx+=stride){
              var idx=xx*4;
              var r=line[idx];
              var g=line[idx+1];
              var b=line[idx+2];
              var a=line[idx+3];
              if(a>0 && (r<thresh || g<thresh || b<thresh)){foundY=yy;break}
            }
            if(foundY>=0){break}
          }
          if(foundY>0){
            var cropH=Math.min(canvas.height, foundY + Math.round(32*scale));
            var c2=document.createElement('canvas');
            c2.width=canvas.width; c2.height=cropH;
            var c2ctx=c2.getContext('2d', { willReadFrequently: true });
            c2ctx.drawImage(canvas,0,0);
            finalCanvas=c2;
          }
        }catch(__e){}
        var pngUrl=null;
        try{
          pngUrl=finalCanvas.toDataURL('image/png');
          showPreview(pngUrl,dataUrl);
        }catch(err){
          if(canvas.toBlob){
            finalCanvas.toBlob(function(blob){
              __previewTempUrl=URL.createObjectURL(blob);
              showPreview(__previewTempUrl,dataUrl);
            },'image/png');
          }else{
            showPreview(null,dataUrl);
          }
        }
      };
      img.src=dataUrl;
    }
    document.getElementById('btnExport').addEventListener('click',exportImage);
  </script>
</body>
</html>
